<canvas id="a" width="500" height="500"></canvas>

<script>
	var canvas = document.getElementById("a");
	var context = canvas.getContext("2d");
	   
    var h= 10;
    var mx = 40;
    var my = 40;

    var maze = new Array(mx*my);
    for(var i = 0; i < mx*my; i++)
    {
    	maze[i] = new Array(mx*my);
    }

	var visited = new Array(my);
    for(var i = 0; i < my; i++)
    {
    	visited[i] = new Array(mx);
    }
	var stack = [];

	var dx = [-1, 0, 1, 0];
	var dy = [0, -1, 0, 1];

    function drawMaze()
    {
    	context.translate(0.5, 0.5);
    	context.beginPath();
    	context.strokeStyle = "#000";

		context.moveTo(0,0);
		context.lineTo(h*mx, 0);
		context.lineTo(h*mx, h*my);
		context.lineTo(0, h*my);
		context.lineTo(0,0);

		for(var i = 0; i < mx; i++)
		{
			context.moveTo(i * h, 0);
			context.lineTo(i * h, my * h);
			context.moveTo(0, i * h);
			context.lineTo(mx * h, i * h);
		}

		context.stroke();

		context.beginPath();
		context.strokeStyle = "#FFF";

		var i = 0;
		var k = 0;
		var intervalId = setInterval(function() {
			var drawn = false;
			var end = false;
			while(!drawn && !end)
				{
				if(maze[i][k]) {
					drawn = true;
					var horizontal = k + mx == i;
					var vertical = (i % mx != 0) && (k + 1 == i);
					if(horizontal) {
						var x1 = (k % mx) * h + 1;
						var y1 = Math.floor(k / mx) * h + h;
						context.moveTo(x1,y1);
						var x2 = x1 + h - 2;
						var y2 = y1;
						context.lineTo(x2, y2);
						context.stroke();
					}
					if(vertical) {
						var x1 = (k % mx)* h + h;
						var y1 = Math.floor(k / mx) * h + 1;
						context.moveTo(x1,y1);
						var x2 = x1;
						var y2 = y1 + h - 2;
						context.lineTo(x2,y2);
						context.stroke();
					}
				}

				k++;
				if(k >= i)
				{
					i++;
					k = 0;
				}
				if(i >= maze.length) end = true;
			}

			if(end) clearInterval(intervalId);

		}, 10);
		
    }

    function count_index(x,y)
    {
    	return y * my + x;
    }

    function get_available(x,y)
    {
    	var avail = []
    	for(var i = 0; i < dx.length; i++)
    	{
    		newx = x + dx[i];
    		newy = y + dy[i];
    		if(newy < my && newy >=0 && newx < mx && newx >= 0)
    		{
    			if(!visited[newy][newx])
    			{
    				avail.push(i);
    			}
    		}
    	}
    	return avail;
    }

    function getRandomArbitary(max)
	{
	  return Math.floor(Math.random() * max);
	}

    function visit(x,y) {
    	if(stack.length > 0) {
    		visited[y][x] = 1;
    		avail = get_available(x,y);
    		while(avail.length > 0) {
    			var next_pos = undefined;
    			if(avail.length == 0) {
    				next_pos = stack.pop();
    			}
    			else {
    				var dest = avail[getRandomArbitary(avail.length)];
    				next_pos = [x + dx[dest], y + dy[dest]];
    				var index = count_index(next_pos[0], next_pos[1]);
    				var prev_index = count_index(x,y);
    				maze[index][prev_index] = 1;
    				maze[prev_index][index] = 1;
    				stack.push(next_pos);
    				visit(next_pos[0], next_pos[1])
    			}
    			avail = get_available(x,y);
    		}
    	}
    }

    stack.push([0,0]);
    visit(0,0);
    drawMaze();

</script>
